{% extends "admin_layout.html" %}

{% block content %}

<style>
    body {
        font-family: Arial, sans-serif;
    }

    .section-title {
        text-align: center;
        margin: 30px 0 20px;
    }

    .portfolio-form {
        width: 500px;
        margin: auto;
        padding: 25px;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
    }

    .input-field,
    select,
    input[type="file"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        transition: 0.3s;
    }

    .input-field:focus,
    select:focus,
    input[type="file"]:focus {
        border-color: black;
        outline: none;
    }

    .submit-btn {
        width: 100%;
        background: black;
        color: white;
        padding: 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: 0.3s;
    }

    .submit-btn:hover {
        background: #333;
    }

    .error {
        color: red;
        font-size: 13px;
        margin-top: 4px;
    }

    hr {
        margin: 50px 0;
    }

    /* Portfolio List Grid */
    .portfolio-list {
        width: 85%;
        margin: auto;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 25px;
    }

    .portfolio-item {
        background: white;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        text-align: center;
        transition: 0.3s;
    }

    .portfolio-item:hover {
        transform: translateY(-5px);
    }

    .portfolio-item img {
        width: 100%;
        height: 170px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 12px;
    }

    .portfolio-item h3 {
        margin: 10px 0 5px;
    }

    .portfolio-item p {
        color: #555;
        margin-bottom: 15px;
    }

    .portfolio-actions a {
        display: inline-block;
        margin: 5px;
        padding: 6px 12px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: 0.3s;
    }

    .edit-btn {
        background: #007bff;
        color: white;
    }

    .edit-btn:hover {
        background: #0056b3;
    }

    .delete-btn {
        background: #dc3545;
        color: white;
    }

    .delete-btn:hover {
        background: #a71d2a;
    }
</style>


<h2 class="section-title">
    {% if edit_mode %} Edit Portfolio {% else %} Add Portfolio {% endif %}
</h2>

<form method="POST" enctype="multipart/form-data" class="portfolio-form">
    {% csrf_token %}

    <div class="form-group">    
        <label>Title</label>
        {{ form.title }}
        <div class="error">{{ form.title.errors }}</div>
    </div>

    <div class="form-group">
        <label>Category</label>
        {{ form.category }}
    </div>

    <div class="form-group" id="custom-category-wrapper">
        <label>Custom Category</label>
        {{ form.custom_category }}
        <div class="error">{{ form.custom_category.errors }}</div>
    </div>

    <div class="form-group">
        <label>Image</label>
        {{ form.image }}
    </div>

    <button type="submit" class="submit-btn">
        {% if edit_mode %} Update Portfolio {% else %} Add Portfolio {% endif %}
    </button>
</form>

<hr>

<h2 class="section-title">Portfolio List</h2>

<div class="portfolio-list">
{% for portfolio in portfolios %}
    <div class="portfolio-item">
        <img src="{{ portfolio.image.url }}">
        <h3>{{ portfolio.title }}</h3>
        <p>{{ portfolio.get_display_category }}</p>

        <div class="portfolio-actions">
            <a href="{% url 'edit_portfolio' portfolio.pk %}" class="edit-btn">Edit</a>
            <a href="{% url 'delete_portfolio' portfolio.pk %}" 
               class="delete-btn"
               onclick="return confirm('Are you sure you want to delete this?')">
               Delete
            </a>
        </div>
    </div>
{% endfor %}
</div>

<script>
    const categoryField = document.getElementById("category-field");
    const customWrapper = document.getElementById("custom-category-wrapper");
    const customInput = document.getElementById("custom-category-field");

    function toggleCustomField() {
        if (categoryField.value === "custom") {
            customWrapper.style.display = "block";
        } else {
            customWrapper.style.display = "none";
            customInput.value = "";
        }
    }

    toggleCustomField();
    categoryField.addEventListener("change", toggleCustomField);
</script>

{% endblock %}